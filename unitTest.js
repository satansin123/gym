
const users =  [
    {
      "_id": "6668aa4cb80bda42c46aa060",
      "name": "njdiofn",
      "email": "fdafvmdasdsnfcdvn@gmail.com",
      "password": "$2b$10$ScDglb4oPQSn.x9n2kQAtuR3Y2Yczbv2iWOQGdY96cXa1iKgYEULW",
      "createdAt": "2024-06-11T19:49:32.855Z",
      "__v": 0
    },
    {
      "_id": "6668b0714d70eba62c2eb0d3",
      "name": "ali",
      "email": "ali@gmail.com",
      "password": "$2b$10$SukMAN6dWeTlhnF93V0Qu.t9z.l.2UUEO1CSOE10UOu5fU1KFFQZS",
      "createdAt": "2024-06-11T20:15:45.399Z",
      "__v": 0
    },
    {
      "_id": "6668b39d2aa56c9e4d4d83ad",
      "name": "ksi",
      "email": "ksi@gmail.com",
      "password": "$2b$10$efxztc.Zlo1DnV7USwGsfu4aYLzW1dV8EDNypxxdkVF/BvmtChdOC",
      "createdAt": "2024-06-11T20:29:17.743Z",
      "__v": 0
    },
    {
      "_id": "666c0adc3b2726c42e423185",
      "name": "aki",
      "email": "f@gmail.com",
      "password": "$2b$10$e.WZgTSYo6iUwXSrmWtuROla3mVYOH6CFEc8IlHjd0LS2Ka1T5EN2",
      "createdAt": "2024-06-14T09:18:20.428Z",
      "__v": 0
    },
    {
      "_id": "666c0b01324ac783e74046fc",
      "name": "aki",
      "email": "fs@gmail.com",
      "password": "$2b$10$CQHs6ZrmM9GyEAT8Ftgek.WxWWXSXOlM3.TWwkdF4RM7sJTqSwAzG",
      "createdAt": "2024-06-14T09:18:57.366Z",
      "__v": 0
    },
    {
      "_id": "666c0b196dc5c5834a1b9816",
      "name": "aki",
      "email": "fds@gmail.com",
      "password": "$2b$10$qCwak0.ICTZl/cwCjq5xJObrzesZyJ1wFs3LKbr1p7CUQhVqjzUpq",
      "createdAt": "2024-06-14T09:19:21.565Z",
      "__v": 0
    },
    {
      "_id": "666c0b83e2c5317c0343d879",
      "name": "ali",
      "email": "fsk@gmail.com",
      "password": "$2b$10$xWrGdZUJwa5YKtTHnYujEOvXz1ZvQjfme46KVN79o6zw4bBxvrKTW",
      "createdAt": "2024-06-14T09:21:07.580Z",
      "__v": 0
    },
    {
      "_id": "666c0baee2c5317c0343d87c",
      "name": "uiChck",
      "email": "uiChk@gmail.com",
      "password": "$2b$10$7JqghSORQwo/u6bCOT4JHuEK9aK.DF6cfYx7RNpYFL24E0oiNMCNK",
      "createdAt": "2024-06-14T09:21:50.541Z",
      "__v": 0
    },
    {
      "_id": "666c0f88c9a812a53202762f",
      "name": "alii",
      "email": "alii@x.com",
      "password": "$2b$10$sm1bGcPVRmR97wrbd/cJIu1/Rn2NOnSjc6Dsyp9ZvWh6mzkjiW40m",
      "createdAt": "2024-06-14T09:38:16.127Z",
      "__v": 0
    },
    {
      "_id": "666d52143b114119048978e1",
      "name": "newGuy",
      "email": "s@gmail.com",
      "password": "$2b$10$atld9yiW.n.sp9IrVV3H6.Rvfk5EzFZUu.hwV9Yqi5LJUQBzTOY4G",
      "createdAt": "2024-06-15T08:34:28.362Z",
      "__v": 0
    },
    {
      "_id": "666d8decd9afbbef216e129f",
      "name": "ali",
      "email": "x@x.com",
      "password": "$2b$10$wc6UpFKGlwUQGx43iUUb.uwAygTOU4N7oowlI2XB2lp9Jm3wVyp4y",
      "createdAt": "2024-06-15T12:49:48.716Z",
      "__v": 0
    },
    {
      "_id": "6686aa32ae037328f0426603",
      "name": "ali",
      "email": "alia@gmail.com",
      "password": "$2b$10$CiU0tYf8YQGCsDHGKrII6uDZGmmuVB83OoxipSOACuxPLAcyvr1cC",
      "createdAt": "2024-07-04T13:57:06.910Z",
      "__v": 0
    },
    {
      "_id": "6686af4482293b59fd526557",
      "name": "ali",
      "email": "aliza@gmail.com",
      "password": "$2b$10$GgCfXZfbdp/V4mraQ/Cf6.Wq.IzWigM5RbEu2D7wKiMkXovB55a1W",
      "createdAt": "2024-07-04T14:18:44.337Z",
      "__v": 0
    },
    {
      "_id": "66927f5effe208255e11b7c6",
      "name": "al",
      "email": "ayo@gmail.com",
      "password": "$2b$10$Y4cLcENwsknKD6SFsfqgC.ciWNKI8TbCKD1J2bhPe7XJts/EDveyq",
      "createdAt": "2024-07-13T13:21:34.189Z",
      "__v": 0
    },
    {
      "_id": "669f4ed5a7428b8955078b1b",
      "name": "ali",
      "email": "alisa@gmail.com",
      "password": "$2b$10$5sUoDIRx7rNI25T4AbcwXeOZibf56Fjgt8OhxttgHVLIiKbh6DA.C",
      "createdAt": "2024-07-23T06:33:57.498Z",
      "__v": 0
    },
    {
      "_id": "669f50335c53f501da221079",
      "name": "ali",
      "email": "alifja@gmail.com",
      "password": "$2b$10$/BImkkjN5Do.5tt6714dUOXr/ysO4FqO5aQKIJOkEbFswHKnwI7RS",
      "createdAt": "2024-07-23T06:39:47.559Z",
      "__v": 0
    },
    {
      "_id": "669f59e096fc655adf3ec571",
      "name": "ali",
      "email": "aliffja@gmail.com",
      "password": "$2b$10$1UtcRoTwQMDmHuXRY72e7uL.ASu7GHMNNUmZGqPilNU.DZ7f5rKJu",
      "createdAt": "2024-07-23T07:21:04.214Z",
      "__v": 0
    },
    {
      "_id": "66b2261ebef87950b2c4c26a",
      "name": "ali",
      "email": "aldiffja@gmail.com",
      "password": "$2b$10$cDBq5c4gpHqcYU9q4W8F9Ora0XlKsifOmmFHJbg9TR.lRKZoZ8nGO",
      "createdAt": "2024-08-06T13:33:18.603Z",
      "__v": 0
    },
    {
      "_id": "66b2263abef87950b2c4c26f",
      "name": "ali",
      "email": "ald,iffja@gmail.com",
      "password": "$2b$10$del17k/W/Eg/xqbWf5bZiuBExvM8CxptoNSezAbH1RZHBqkjct6YC",
      "createdAt": "2024-08-06T13:33:46.587Z",
      "__v": 0
    },
    {
      "_id": "66b85b3fa9b0070af6572ebc",
      "name": "ksi",
      "email": "alias@gmail.com",
      "password": "$2b$10$c8eDHf5eWrDwOLiY0GPc6eN4WeYep0zfJ7MPjqcibq974GtHHAVU.",
      "createdAt": "2024-08-11T06:33:35.740Z",
      "__v": 0
    },
    {
      "_id": "66b85c0aa9b0070af6572eca",
      "name": " sdc",
      "email": "alikas@gmail.com",
      "password": "$2b$10$ZAQxAgsu9GcTDbfwdixEBeMGW5oxx7actrFIHwJKaaGJVYJaLHe4y",
      "createdAt": "2024-08-11T06:36:58.822Z",
      "__v": 0
    },
    {
      "_id": "66b86186517f6d4c56f69bf8",
      "name": "fesf",
      "email": "aliabs@gmail.com",
      "password": "$2b$10$kpJ6iYfszbfGlct3uyXjde6/VrBn1WssrRcLfrsWf9dZI59orJmVi",
      "createdAt": "2024-08-11T07:00:22.737Z",
      "__v": 0
    },
    {
      "_id": "66b862bb62edae8eb41fd1fb",
      "name": "sa",
      "email": "alabaia@gmail.com",
      "password": "$2b$10$hPVkg.SGUHWu52LNd3EcO.z0qG8yWOCdvQEVb.JSsBpBlp2kQPmkq",
      "createdAt": "2024-08-11T07:05:31.094Z",
      "__v": 0
    },
    {
      "_id": "66b9ed14669ef2a40a67e810",
      "name": "ali",
      "email": "aldz,iffja@gmail.com",
      "password": "$2b$10$BQmlYdAYwYtIL0qsL2V2cetrJ8qNS2GrPgBE9HuzyjH.jmOiWBnKS",
      "createdAt": "2024-08-12T11:08:04.068Z",
      "__v": 0
    },
    {
      "_id": "66b9ee63bfc806b8dac27bb1",
      "name": "fdsf",
      "email": "ks32@gmail.com",
      "password": "$2b$10$vCANEtA6K3UwB76.Iu9cJuatQ34NEcR1KZ6TddVzPsbzPNYLX7L1S",
      "createdAt": "2024-08-12T11:13:39.365Z",
      "__v": 0
    },
    {
      "_id": "66bcb651d02fdec4d718a8eb",
      "name": "vdsf",
      "email": "aliadsads@gmail.com",
      "password": "$2b$10$fdEDPex7b/eXSHK/HGXmuemuevYpDPOTKpvSP3wVBEUXCMEDsnsn.",
      "createdAt": "2024-08-14T13:51:13.755Z",
      "__v": 0
    },
    {
      "_id": "66bcb70bd02fdec4d718a909",
      "name": "vsdcv",
      "email": "aliacs@gmail.com",
      "password": "$2b$10$x2afl1knCYkAEEGRoAzMruh8UJ1EI43a4GbWaJc7vnW66HLhj2BvW",
      "createdAt": "2024-08-14T13:54:19.189Z",
      "__v": 0
    },
    {
      "_id": "66bcbbaf1da33339d889f3ce",
      "name": "afsd",
      "email": "alidas@gmail.com",
      "password": "$2b$10$M16f2u.Y1YX1xG8IUX7P9O4PTqM24wm1lUpzupVRNv6/ZCd5nq3tm",
      "createdAt": "2024-08-14T14:14:07.879Z",
      "__v": 0
    }
  ]




try {

  if (!users || users.length === 0) {
    return res.status(409).json({ error: "No users registered" });
  }

  const userIds = users.map(user => user._id);
  const clans = await ClanUser.find({ uid: { $in: userIds } });

  const clansByUserId = clans.reduce((acc, clan) => {
    acc[clan.uid] = {
      clanIds: clan.clanIds || [],
      clanNames: clan.clanNames || []
    };
    return acc;
  }, {});

  users.forEach(user => {
    user.clans = clansByUserId[user._id] || { clanIds: [], clanNames: [] };
  });

  console.log(users);
  return res.json({ users });
} catch (error) {
  console.error("Error during fetch all users:", error);
  return res.status(500).json({ error: "Internal Server Error" });
}